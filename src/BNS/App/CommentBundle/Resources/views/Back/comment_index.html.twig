<script type="text/javascript">
	$(function ()
	{
		// Filters process
		$('.comment-sidebar-filter').click(function (e)
		{
			$('.comment-sidebar-filter').removeClass('active');
			var $this = $(e.currentTarget),
				$layer = $('#comment-layer');
				
			$this.addClass('active');
			$layer.fadeIn('fast');
			
			$.ajax({
				url: $this.attr('href'),
				type: 'POST',
				dataType: 'html',
				data: {'namespace': '{{ namespace }}', 'page': 1, 'status': $this.data('filter-status')},
				success: function (data)
				{
					$('.comments-list').html(data);
				}
			}).done(function ()
			{
				$layer.fadeOut('fast');
			});
			
			return false;
		});
		
		// Buttons moderation process
		$('.comment-moderation a').live('click', function (e)
		{
			var $this = $(e.currentTarget),
				$row = $this.parent().parent().parent(),
				id = $row.attr('id').split('-');
				
			id = id[1];
			$row.css('opacity', '.4').addClass('disabled');
			var page = $('.pagination').length > 0 ? $('.pagination').data('current-page') : 1;
			
			$.ajax({
				url: '{{ path('comment_manager_status_update') }}',
				type: 'POST',
				dataType: 'json',
				data: {
					'namespace': '{{ namespace }}',
					'status': $this.data('filter-status'),
					'id': id,
					'page': page
				},
				success: function (data)
				{
					$data = $(data.comment);
					$data.css('display', 'none');

					if ($('.pagination').length > 0) {
						$('.pagination').before($data);
					}
					else {
						$('.comments-list').append($data);
					}

					$data.slideDown('slow');
					
					if (data.pager != '') {
						$('.pagination').replaceWith(data.pager);
					}
					else {
						$('.pagination').slideUp('slow');
					}
				}
			}).done(function ()
			{
				$row.slideUp('slow');
			});
			
			return false;
		});
		
		// Pagination process
		$('.pagination a').live('click', function (e)
		{
			var $this = $(e.currentTarget),
				$layer = $('#comment-layer');
			
			$layer.fadeIn('fast');
			setTimeout(function ()
			{
				$layer.find('.message').addClass('bottom');
			}, 50);
			
			$.ajax({
				url: $this.attr('href'),
				type: 'POST',
				dataType: 'html',
				data: {
					'namespace': '{{ namespace }}',
					'page': $this.data('page'),
					'status': $this.parent().parent().parent().data('status')
				},
				success: function (data)
				{
					$('.comments-list').html(data);
				}
			}).done(function ()
			{
				$layer.fadeOut('fast');
				$layer.find('.message').removeClass('bottom');
			});
			
			return false;
		});
		
		// Validate all button process
		$('div.header-buttons .validate-all-comments').click(function (e)
		{
			var $this = $(e.currentTarget);
			
			if ($this.hasClass('disabled')) {
				return false;
			}
			
			$this.addClass('disabled').attr('disabled', 'disabled');
			$.ajax({
				url: '{{ path('comment_manager_validate_all') }}',
				type: 'POST',
				data: {'namespace': '{{ namespace }}'},
				success: function ()
				{
					window.location.reload(true);
				}
			});
			
			return false;
		});
	});
</script>

<div class="comments-list-container">
	<div id="comment-layer" class="layer span9 no-margin">
		<div class="message">
			Chargement des commentaires en cours
			<div><img src="{{ asset('/medias/images/icons/big-loader.gif') }}" alt=""></div>
		</div>
	</div>
	<div class="comments-list">
		{% render 'BNSAppCommentBundle:BackComment:show' with {'namespace': namespace, 'page': page} %}
	</div>
</div>